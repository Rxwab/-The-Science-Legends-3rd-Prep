<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع العلوم - الصف الثالث الإعدادي</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2em;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            margin: 0 auto;
        }

        .login-container h2 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .main-dashboard {
            display: none;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: #667eea;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .user-details h3 {
            color: white;
            margin-bottom: 5px;
        }

        .user-details p {
            color: rgba(255, 255, 255, 0.8);
        }

        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .room-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
        }

        .room-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            border-color: #667eea;
        }

        .room-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .room-card p {
            color: #666;
            margin-bottom: 20px;
        }

        .room-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .questions-room { color: #4CAF50; }
        .news-room { color: #FF9800; }
        .homework-room { color: #2196F3; }
        .explanations-room { color: #9C27B0; }
        .chat-room { color: #F44336; }
        .leaderboard-room { color: #FFD700; }
        .store-room { color: #E91E63; }
        .profile-room { color: #607D8B; }

        .room-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
        }

        .back-btn {
            background: #666;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .question-container {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #333;
        }

        .answers {
            display: grid;
            gap: 10px;
        }

        .answer-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: right;
        }

        .answer-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .answer-btn.correct {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .answer-btn.incorrect {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .score-display {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            animation: fadeIn 0.5s;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-container {
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow-y: auto;
            padding: 15px;
            background: #f9f9f9;
            margin-bottom: 15px;
        }

        .chat-message {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .store-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .store-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .store-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .store-item.owned {
            border-color: #4CAF50;
            background: #f0f8f0;
        }

        .leaderboard {
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .leaderboard-item:nth-child(1) { background: linear-gradient(135deg, #FFD700, #FFA500); color: white; }
        .leaderboard-item:nth-child(2) { background: linear-gradient(135deg, #C0C0C0, #A0A0A0); color: white; }
        .leaderboard-item:nth-child(3) { background: linear-gradient(135deg, #CD7F32, #B8860B); color: white; }

        .rank {
            font-size: 1.5em;
            font-weight: bold;
            margin-left: 15px;
            min-width: 40px;
        }

        .teacher-badge {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-right: 10px;
        }

        .admin-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .admin-panel h3 {
            color: white;
            margin-bottom: 15px;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .admin-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .hidden {
            display: none !important;
        }

        .error-text {
            color: #f44336;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .success-text {
            color: #4CAF50;
            font-size: 0.9em;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .login-container {
                padding: 20px;
            }
            
            .rooms-grid {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔬 موقع العلوم التفاعلي</h1>
            <p>الصف الثالث الإعدادي - الحركة والسرعة</p>
        </div>

        <!-- صفحة تسجيل الدخول -->
        <div id="loginPage" class="login-container">
            <h2>تسجيل الدخول</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="fullName">الاسم الكامل *</label>
                    <input type="text" id="fullName" required placeholder="مثال: أحمد محمد علي">
                    <div id="nameError" class="error-text hidden">يجب إدخال الاسم الكامل (أكثر من كلمة واحدة)</div>
                </div>

                <div class="form-group">
                    <label for="age">العمر *</label>
                    <input type="number" id="age" required min="10" max="20" placeholder="مثال: 15">
                </div>

                <div class="form-group">
                    <label for="password">كلمة المرور *</label>
                    <input type="password" id="password" required placeholder="أدخل كلمة المرور">
                </div>

                <div class="form-group">
                    <label for="profileImage">الصورة الشخصية (اختياري)</label>
                    <input type="file" id="profileImage" accept="image/*">
                </div>

                <button type="submit" class="btn">دخول</button>
            </form>
        </div>

        <!-- الصفحة الرئيسية -->
        <div id="mainDashboard" class="main-dashboard">
            <!-- معلومات المستخدم -->
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">👤</div>
                <div class="user-details">
                    <h3 id="userName"></h3>
                    <p id="userAge"></p>
                    <p id="userPoints">النقاط: 0</p>
                </div>
            </div>

            <!-- لوحة تحكم الأستاذ -->
            <div id="adminPanel" class="admin-panel hidden">
                <h3>🎓 لوحة تحكم الأستاذ</h3>
                <div class="admin-controls">
                    <button class="admin-btn" onclick="clearAllChat()">مسح جميع الرسائل</button>
                    <button class="admin-btn" onclick="resetAllScores()">إعادة تعيين النقاط</button>
                    <button class="admin-btn" onclick="exportData()">تصدير البيانات</button>
                </div>
            </div>

            <!-- الرومات -->
            <div class="rooms-grid">
                <div class="room-card" onclick="openRoom('questions')">
                    <div class="room-icon questions-room">❓</div>
                    <h3>روم الأسئلة</h3>
                    <p>100 سؤال في العلوم - احصل على نقطة لكل إجابة صحيحة</p>
                </div>

                <div class="room-card" id="newsRoomCard" onclick="openRoom('news')">
                    <div class="room-icon news-room">📰</div>
                    <h3>روم الأخبار</h3>
                    <p>آخر الأخبار والإعلانات المهمة</p>
                </div>

                <div class="room-card" onclick="openRoom('homework')">
                    <div class="room-icon homework-room">📚</div>
                    <h3>روم الواجبات</h3>
                    <p>الواجبات والمهام الدراسية</p>
                </div>

                <div class="room-card" onclick="openRoom('explanations')">
                    <div class="room-icon explanations-room">🎓</div>
                    <h3>روم الشروحات</h3>
                    <p>شروحات مفصلة للدروس</p>
                </div>

                <div class="room-card" onclick="openRoom('chat')">
                    <div class="room-icon chat-room">💬</div>
                    <h3>روم الشات</h3>
                    <p>دردشة مع زملائك في الصف</p>
                </div>

                <div class="room-card" onclick="openRoom('leaderboard')">
                    <div class="room-icon leaderboard-room">🏆</div>
                    <h3>الأوائل</h3>
                    <p>ترتيب أفضل 100 طالب</p>
                </div>

                <div class="room-card" onclick="openRoom('store')">
                    <div class="room-icon store-room">🛒</div>
                    <h3>المتجر</h3>
                    <p>اشتري إطارات وخلفيات بالنقاط</p>
                </div>

                <div class="room-card" onclick="openRoom('profile')">
                    <div class="room-icon profile-room">👤</div>
                    <h3>الملف الشخصي</h3>
                    <p>إدارة حسابك ومعلوماتك</p>
                </div>
            </div>
        </div>

        <!-- محتوى الرومات -->
        <div id="questionsRoom" class="room-content">
            <button class="back-btn" onclick="closeRoom()">← العودة للرئيسية</button>
            <h2>🔬 روم الأسئلة - العلوم</h2>
            <div class="score-display">
                نقاطك الحالية: <span id="currentScore">0</span>
            </div>
            <div id="questionContainer"></div>
            <div id="questionMessage"></div>
        </div>

        <div id="newsRoom" class="room-content">
            <button class="back-btn" onclick="closeRoom()">← العودة للرئيسية</button>
            <h2>📰 روم الأخبار</h2>
            <div id="newsContainer"></div>
            <div id="addNewsForm" class="hidden">
                <h3>إضافة خبر جديد</h3>
                <input type="text" id="newsTitle" placeholder="عنوان الخبر">
                <textarea id="newsContent" placeholder="محتوى الخبر" rows="4" style="width: 100%; margin: 10px 0; padding: 10px; border-radius: 8px; border: 1px solid #ddd;"></textarea>
                <input type="file" id="newsImage" accept="image/*">
                <input type="url" id="newsLink" placeholder="رابط (اختياري)">
                <button class="btn" onclick="addNews()">نشر الخبر</button>
            </div>
        </div>

        <div id="homeworkRoom" class="room-content">
            <button class="back-btn" onclick="closeRoom()">← العودة للرئيسية</button>
            <h2>📚 روم الواجبات</h2>
            <button class="btn" onclick="showAddHomeworkForm()" style="margin-bottom: 20px;">إضافة واجب جديد</button>
            <div id="homeworkContainer"></div>
            <div id="addHomeworkForm" class="hidden">
                <h3>إضافة واجب جديد</h3>
                <input type="text" id="homeworkTitle" placeholder="عنوان الواجب">
                <textarea id="homeworkDescription" placeholder="وصف الواجب" rows="4" style="width: 100%; margin: 10px 0; padding: 10px; border-radius: 8px; border: 1px solid #ddd;"></textarea>
                <input type="file" id="homeworkImage" accept="image/*">
                <input type="url" id="homeworkVideo" placeholder="رابط فيديو (يوتيوب أو غيره)">
                <button class="btn" onclick="addHomework()">إضافة الواجب</button>
            </div>
        </div>

        <div id="explanationsRoom" class="room-content">
            <button class="back-btn" onclick="closeRoom()">← العودة للرئيسية</button>
            <h2>🎓 روم الشروحات</h2>
            <button class="btn" onclick="showAddExplanationForm()" style="margin-bottom: 20px;">إضافة شرح جديد</button>
            <div id="explanationsContainer"></div>
            <div id="addExplanationForm" class="hidden">
                <h3>إضافة شرح جديد</h3>
                <input type="text" id="explanationTitle" placeholder="عنوان الشرح">
                <textarea id="explanationContent" placeholder="محتوى الشرح" rows="6" style="width: 100%; margin: 10px 0; padding: 10px; border-radius: 8px; border: 1px solid #ddd;"></textarea>
                <input type="file" id="explanationImage" accept="image/*">
                <input type="url" id="explanationVideo" placeholder="رابط فيديو (يوتيوب أو غيره)">
                <button class="btn" onclick="addExplanation()">إضافة الشرح</button>
            </div>
        </div>

        <div id="chatRoom" class="room-content">
            <button class="back-btn" onclick="closeRoom()">← العودة للرئيسية</button>
            <h2>💬 روم الشات</h2>
            <div class="chat-container" id="chatContainer"></div>
            <div class="chat-input">
                <input type="text" id="chatMessage" placeholder="اكتب رسالتك هنا..." onkeypress="handleChatKeyPress(event)">
                <button class="btn" onclick="sendMessage()">إرسال</button>
            </div>
        </div>

        <div id="leaderboardRoom" class="room-content">
            <button class="back-btn" onclick="closeRoom()">← العودة للرئيسية</button>
            <h2>🏆 الأوائل</h2>
            <div class="leaderboard" id="leaderboardContainer"></div>
        </div>

        <div id="storeRoom" class="room-content">
            <button class="back-btn" onclick="closeRoom()">← العودة للرئيسية</button>
            <h2>🛒 المتجر</h2>
            <div class="score-display">
                نقاطك المتاحة: <span id="storeScore">0</span>
            </div>
            <div class="store-items" id="storeContainer"></div>
        </div>

        <div id="profileRoom" class="room-content">
            <button class="back-btn" onclick="closeRoom()">← العودة للرئيسية</button>
            <h2>👤 الملف الشخصي</h2>
            <div id="profileContainer"></div>
        </div>
    </div>

    <script>
        // بيانات الأسئلة
        const questions = [
            {
                question: "ما هي وحدة قياس السرعة في النظام الدولي؟",
                answers: ["متر/ثانية", "كيلومتر/ساعة", "سنتيمتر/ثانية", "ميل/ساعة"],
                correct: 0,
                explanation: "وحدة قياس السرعة في النظام الدولي هي متر/ثانية (م/ث)"
            },
            {
                question: "إذا قطع جسم مسافة 100 متر في 10 ثوانٍ، فما سرعته؟",
                answers: ["5 م/ث", "10 م/ث", "15 م/ث", "20 م/ث"],
                correct: 1,
                explanation: "السرعة = المسافة ÷ الزمن = 100 ÷ 10 = 10 م/ث"
            },
            {
                question: "ما المقصود بالسرعة المنتظمة؟",
                answers: ["السرعة التي تتغير بانتظام", "السرعة الثابتة", "السرعة العالية", "السرعة المنخفضة"],
                correct: 1,
                explanation: "السرعة المنتظمة هي السرعة الثابتة التي لا تتغير مع الزمن"
            },
            {
                question: "أي من التالي يمثل حركة منتظمة؟",
                answers: ["سيارة تسير بسرعة ثابتة", "كرة تسقط من علو", "قطار يتوقف", "دراجة تسرع"],
                correct: 0,
                explanation: "الحركة المنتظمة هي التي تتم بسرعة ثابتة دون تسارع أو تباطؤ"
            },
            {
                question: "ما هي السرعة النسبية؟",
                answers: ["سرعة الجسم بالنسبة للأرض", "سرعة الجسم بالنسبة لجسم آخر", "السرعة القصوى للجسم", "السرعة الدنيا للجسم"],
                correct: 1,
                explanation: "السرعة النسبية هي سرعة جسم بالنسبة لجسم آخر متحرك"
            },
            {
                question: "إذا كانت سرعة قطار 60 كم/ساعة، فكم تساوي بالمتر/ثانية؟",
                answers: ["16.67 م/ث", "20 م/ث", "60 م/ث", "216 م/ث"],
                correct: 0,
                explanation: "للتحويل من كم/ساعة إلى م/ث نقسم على 3.6: 60 ÷ 3.6 = 16.67 م/ث"
            },
            {
                question: "ما هو قانون حساب السرعة؟",
                answers: ["السرعة = الزمن ÷ المسافة", "السرعة = المسافة × الزمن", "السرعة = المسافة ÷ الزمن", "السرعة = المسافة + الزمن"],
                correct: 2,
                explanation: "قانون السرعة هو: السرعة = المسافة المقطوعة ÷ الزمن المستغرق"
            },
            {
                question: "أي من التالي يؤثر على السرعة النسبية؟",
                answers: ["اتجاه الحركة فقط", "مقدار السرعة فقط", "كل من المقدار والاتجاه", "لا شيء مما سبق"],
                correct: 2,
                explanation: "السرعة النسبية تتأثر بكل من مقدار السرعة واتجاه الحركة للجسمين"
            },
            {
                question: "ما هي وحدة قياس المسافة في النظام الدولي؟",
                answers: ["الكيلومتر", "السنتيمتر", "المتر", "الميل"],
                correct: 2,
                explanation: "وحدة قياس المسافة في النظام الدولي هي المتر"
            },
            {
                question: "إذا تحرك جسم بسرعة 20 م/ث لمدة 5 ثوانٍ، فما المسافة المقطوعة؟",
                answers: ["4 متر", "25 متر", "100 متر", "15 متر"],
                correct: 2,
                explanation: "المسافة = السرعة × الزمن = 20 × 5 = 100 متر"
            }
        ];

        // متغيرات عامة
        let currentUser = null;
        let currentQuestionIndex = 0;
        let userScore = 0;
        let isTeacher = false;

        // بيانات المتجر
        const storeItems = [
            { id: 1, name: "إطار ذهبي", price: 50, type: "frame", color: "#FFD700" },
            { id: 2, name: "إطار أزرق", price: 30, type: "frame", color: "#4169E1" },
            { id: 3, name: "خلفية فخمة", price: 100, type: "background", image: "gradient(135deg, #667eea 0%, #764ba2 100%)" },
            { id: 4, name: "شعار النجمة", price: 75, type: "badge", icon: "⭐" },
            { id: 5, name: "شعار التاج", price: 150, type: "badge", icon: "👑" }
        ];

        // تحميل البيانات عند بدء التشغيل
        window.onload = function() {
            loadUserData();
            generateMoreQuestions();
        };

        // تسجيل الدخول
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('fullName').value.trim();
            const age = document.getElementById('age').value;
            const password = document.getElementById('password').value;
            const profileImage = document.getElementById('profileImage').files[0];
            
            // التحقق من صحة الاسم
            if (fullName.split(' ').length < 2) {
                document.getElementById('nameError').classList.remove('hidden');
                return;
            } else {
                document.getElementById('nameError').classList.add('hidden');
            }
            
            // التحقق من كلمة مرور الأستاذ
            isTeacher = password === '6450';
            
            // إنشاء بيانات المستخدم
            currentUser = {
                name: fullName,
                age: age,
                password: password,
                isTeacher: isTeacher,
                score: getUserScore(fullName) || 0,
                ownedItems: getUserOwnedItems(fullName) || []
            };
            
            // حفظ الصورة الشخصية
            if (profileImage) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentUser.profileImage = e.target.result;
                    saveUserData();
                    showDashboard();
                };
                reader.readAsDataURL(profileImage);
            } else {
                saveUserData();
                showDashboard();
            }
        });

        // عرض لوحة التحكم
        function showDashboard() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainDashboard').style.display = 'block';
            
            // عرض معلومات المستخدم
            document.getElementById('userName').textContent = currentUser.name + (currentUser.isTeacher ? ' 🎓' : '');
            document.getElementById('userAge').textContent = `العمر: ${currentUser.age} سنة`;
            document.getElementById('userPoints').textContent = `النقاط: ${currentUser.score}`;
            
            // عرض الصورة الشخصية
            if (currentUser.profileImage) {
                document.getElementById('userAvatar').innerHTML = `<img src="${currentUser.profileImage}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            }
            
            // عرض لوحة تحكم الأستاذ
            if (currentUser.isTeacher) {
                document.getElementById('adminPanel').classList.remove('hidden');
            } else {
                document.getElementById('newsRoomCard').style.display = 'none';
            }
            
            updateLeaderboard();
        }

        // فتح الرومات
        function openRoom(roomType) {
            document.getElementById('mainDashboard').style.display = 'none';
            document.getElementById(roomType + 'Room').style.display = 'block';
            
            switch(roomType) {
                case 'questions':
                    loadQuestion();
                    break;
                case 'news':
                    loadNews();
                    break;
                case 'homework':
                    loadHomework();
                    break;
                case 'explanations':
                    loadExplanations();
                    break;
                case 'chat':
                    loadChat();
                    break;
                case 'leaderboard':
                    updateLeaderboard();
                    break;
                case 'store':
                    loadStore();
                    break;
                case 'profile':
                    loadProfile();
                    break;
            }
        }

        // إغلاق الرومات
        function closeRoom() {
            const rooms = document.querySelectorAll('.room-content');
            rooms.forEach(room => room.style.display = 'none');
            document.getElementById('mainDashboard').style.display = 'block';
        }

        // تحميل الأسئلة
        function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
                document.getElementById('questionContainer').innerHTML = '<div class="message success">🎉 تهانينا! لقد أنهيت جميع الأسئلة!</div>';
                return;
            }
            
            const question = questions[currentQuestionIndex];
            document.getElementById('currentScore').textContent = currentUser.score;
            
            const questionHTML = `
                <div class="question-container">
                    <div class="question-text">السؤال ${currentQuestionIndex + 1}: ${question.question}</div>
                    <div class="answers">
                        ${question.answers.map((answer, index) => 
                            `<button class="answer-btn" onclick="selectAnswer(${index})">${answer}</button>`
                        ).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('questionContainer').innerHTML = questionHTML;
            document.getElementById('questionMessage').innerHTML = '';
        }

        // اختيار الإجابة
        function selectAnswer(selectedIndex) {
            const question = questions[currentQuestionIndex];
            const answerButtons = document.querySelectorAll('.answer-btn');
            
            answerButtons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === question.correct) {
                    btn.classList.add('correct');
                } else if (index === selectedIndex && index !== question.correct) {
                    btn.classList.add('incorrect');
                }
            });
            
            if (selectedIndex === question.correct) {
                currentUser.score++;
                userScore = currentUser.score;
                document.getElementById('questionMessage').innerHTML = `
                    <div class="message success">
                        🎉 إجابة صحيحة! أحسنت! حصلت على نقطة جديدة.
                    </div>
                `;
            } else {
                document.getElementById('questionMessage').innerHTML = `
                    <div class="message error">
                        😔 إجابة خاطئة، لا تقلق ستتحسن في المرة القادمة!  

                        <strong>الإجابة الصحيحة:</strong> ${question.explanation}
                    </div>
                `;
            }
            
            // الانتقال للسؤال التالي بعد 3 ثوانٍ
            setTimeout(() => {
                currentQuestionIndex++;
                loadQuestion();
                updateUserPoints();
                saveUserData();
            }, 3000);
        }

        // تحديث النقاط
        function updateUserPoints() {
            document.getElementById('userPoints').textContent = `النقاط: ${currentUser.score}`;
            document.getElementById('currentScore').textContent = currentUser.score;
            if (document.getElementById('storeScore')) {
                document.getElementById('storeScore').textContent = currentUser.score;
            }
        }

        // تحميل الأخبار
        function loadNews() {
            if (currentUser.isTeacher) {
                document.getElementById('addNewsForm').classList.remove('hidden');
            }
            
            const news = getStoredData('news') || [];
            const newsHTML = news.map(item => `
                <div class="message" style="background: white; border: 1px solid #ddd; margin-bottom: 15px;">
                    <h4>${item.title}</h4>
                    <p>${item.content}</p>
                    ${item.image ? `<img src="${item.image}" style="max-width: 100%; border-radius: 8px; margin: 10px 0;">` : ''}
                    ${item.link ? `<a href="${item.link}" target="_blank" style="color: #667eea;">🔗 رابط مفيد</a>` : ''}
                    <small style="color: #666;">نشر بواسطة: ${item.author} - ${item.date}</small>
                    ${currentUser.isTeacher ? `<button onclick="deleteNews(${item.id})" style="background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin-right: 10px;">حذف</button>` : ''}
                </div>
            `).join('');
            
            document.getElementById('newsContainer').innerHTML = newsHTML || '<p>لا توجد أخبار حالياً</p>';
        }

        // إضافة خبر
        function addNews() {
            const title = document.getElementById('newsTitle').value;
            const content = document.getElementById('newsContent').value;
            const imageFile = document.getElementById('newsImage').files[0];
            const link = document.getElementById('newsLink').value;
            
            if (!title || !content) {
                alert('يرجى ملء العنوان والمحتوى');
                return;
            }
            
            const newsItem = {
                id: Date.now(),
                title: title,
                content: content,
                link: link,
                author: currentUser.name,
                date: new Date().toLocaleDateString('ar-SA')
            };
            
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    newsItem.image = e.target.result;
                    saveNews(newsItem);
                };
                reader.readAsDataURL(imageFile);
            } else {
                saveNews(newsItem);
            }
        }

        function saveNews(newsItem) {
            const news = getStoredData('news') || [];
            news.unshift(newsItem);
            localStorage.setItem('news', JSON.stringify(news));
            
            // مسح النموذج
            document.getElementById('newsTitle').value = '';
            document.getElementById('newsContent').value = '';
            document.getElementById('newsImage').value = '';
            document.getElementById('newsLink').value = '';
            
            loadNews();
        }

        // حذف خبر
        function deleteNews(newsId) {
            if (confirm('هل أنت متأكد من حذف هذا الخبر؟')) {
                const news = getStoredData('news') || [];
                const updatedNews = news.filter(item => item.id !== newsId);
                localStorage.setItem('news', JSON.stringify(updatedNews));
                loadNews();
            }
        }

        // تحميل الواجبات
        function loadHomework() {
            const homework = getStoredData('homework') || [];
            const homeworkHTML = homework.map(item => `
                <div class="message" style="background: white; border: 1px solid #ddd; margin-bottom: 15px;">
                    <h4>📚 ${item.title}</h4>
                    <p>${item.description}</p>
                    ${item.image ? `<img src="${item.image}" style="max-width: 100%; border-radius: 8px; margin: 10px 0;">` : ''}
                    ${item.video ? `<a href="${item.video}" target="_blank" style="color: #667eea;">🎥 مشاهدة الفيديو</a>` : ''}
                    <small style="color: #666;">أضيف بواسطة: ${item.author} - ${item.date}</small>
                </div>
            `).join('');
            
            document.getElementById('homeworkContainer').innerHTML = homeworkHTML || '<p>لا توجد واجبات حالياً</p>';
        }

        // عرض نموذج إضافة واجب
        function showAddHomeworkForm() {
            const form = document.getElementById('addHomeworkForm');
            form.classList.toggle('hidden');
        }

        // إضافة واجب
        function addHomework() {
            const title = document.getElementById('homeworkTitle').value;
            const description = document.getElementById('homeworkDescription').value;
            const imageFile = document.getElementById('homeworkImage').files[0];
            const video = document.getElementById('homeworkVideo').value;
            
            if (!title || !description) {
                alert('يرجى ملء العنوان والوصف');
                return;
            }
            
            const homeworkItem = {
                id: Date.now(),
                title: title,
                description: description,
                video: video,
                author: currentUser.name,
                date: new Date().toLocaleDateString('ar-SA')
            };
            
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    homeworkItem.image = e.target.result;
                    saveHomework(homeworkItem);
                };
                reader.readAsDataURL(imageFile);
            } else {
                saveHomework(homeworkItem);
            }
        }

        function saveHomework(homeworkItem) {
            const homework = getStoredData('homework') || [];
            homework.unshift(homeworkItem);
            localStorage.setItem('homework', JSON.stringify(homework));
            
            // مسح النموذج
            document.getElementById('homeworkTitle').value = '';
            document.getElementById('homeworkDescription').value = '';
            document.getElementById('homeworkImage').value = '';
            document.getElementById('homeworkVideo').value = '';
            document.getElementById('addHomeworkForm').classList.add('hidden');
            
            loadHomework();
        }

        // تحميل الشروحات
        function loadExplanations() {
            const explanations = getStoredData('explanations') || [];
            const explanationsHTML = explanations.map(item => `
                <div class="message" style="background: white; border: 1px solid #ddd; margin-bottom: 15px;">
                    <h4>🎓 ${item.title}</h4>
                    <p style="white-space: pre-line;">${item.content}</p>
                    ${item.image ? `<img src="${item.image}" style="max-width: 100%; border-radius: 8px; margin: 10px 0;">` : ''}
                    ${item.video ? `<a href="${item.video}" target="_blank" style="color: #667eea;">🎥 مشاهدة الفيديو</a>` : ''}
                    <small style="color: #666;">أضيف بواسطة: ${item.author} - ${item.date}</small>
                </div>
            `).join('');
            
            document.getElementById('explanationsContainer').innerHTML = explanationsHTML || '<p>لا توجد شروحات حالياً</p>';
        }

        // عرض نموذج إضافة شرح
        function showAddExplanationForm() {
            const form = document.getElementById('addExplanationForm');
            form.classList.toggle('hidden');
        }

        // إضافة شرح
        function addExplanation() {
            const title = document.getElementById('explanationTitle').value;
            const content = document.getElementById('explanationContent').value;
            const imageFile = document.getElementById('explanationImage').files[0];
            const video = document.getElementById('explanationVideo').value;
            
            if (!title || !content) {
                alert('يرجى ملء العنوان والمحتوى');
                return;
            }
            
            const explanationItem = {
                id: Date.now(),
                title: title,
                content: content,
                video: video,
                author: currentUser.name,
                date: new Date().toLocaleDateString('ar-SA')
            };
            
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    explanationItem.image = e.target.result;
                    saveExplanation(explanationItem);
                };
                reader.readAsDataURL(imageFile);
            } else {
                saveExplanation(explanationItem);
            }
        }

        function saveExplanation(explanationItem) {
            const explanations = getStoredData('explanations') || [];
            explanations.unshift(explanationItem);
            localStorage.setItem('explanations', JSON.stringify(explanations));
            
            // مسح النموذج
            document.getElementById('explanationTitle').value = '';
            document.getElementById('explanationContent').value = '';
            document.getElementById('explanationImage').value = '';
            document.getElementById('explanationVideo').value = '';
            document.getElementById('addExplanationForm').classList.add('hidden');
            
            loadExplanations();
        }

        // تحميل الشات
        function loadChat() {
            const messages = getStoredData('chatMessages') || [];
            const chatHTML = messages.map(msg => `
                <div class="chat-message">
                    <strong>${msg.author}:</strong> ${msg.message}
                    <small style="color: #666; display: block; margin-top: 5px;">${msg.time}</small>
                    ${currentUser.isTeacher ? `<button onclick="deleteMessage(${msg.id})" style="background: #f44336; color: white; border: none; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-top: 5px;">حذف</button>` : ''}
                </div>
            `).join('');
            
            document.getElementById('chatContainer').innerHTML = chatHTML;
            document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
        }

        // إرسال رسالة
        function sendMessage() {
            const messageInput = document.getElementById('chatMessage');
            const message = messageInput.value.trim();
            
            if (!message) return;
            
            const chatMessage = {
                id: Date.now(),
                author: currentUser.name,
                message: message,
                time: new Date().toLocaleString('ar-SA')
            };
            
            const messages = getStoredData('chatMessages') || [];
            messages.push(chatMessage);
            localStorage.setItem('chatMessages', JSON.stringify(messages));
            
            messageInput.value = '';
            loadChat();
        }

        // التعامل مع مفتاح Enter في الشات
        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // حذف رسالة
        function deleteMessage(messageId) {
            if (confirm('هل أنت متأكد من حذف هذه الرسالة؟')) {
                const messages = getStoredData('chatMessages') || [];
                const updatedMessages = messages.filter(msg => msg.id !== messageId);
                localStorage.setItem('chatMessages', JSON.stringify(updatedMessages));
                loadChat();
            }
        }

        // تحديث لوحة الأوائل
        function updateLeaderboard() {
            const users = getStoredData('users') || {};
            const usersList = Object.values(users).sort((a, b) => b.score - a.score).slice(0, 100);
            
            const leaderboardHTML = usersList.map((user, index) => `
                <div class="leaderboard-item">
                    <div class="rank">${index + 1}</div>
                    <div style="flex: 1;">
                        <strong>${user.name}</strong>
                        ${user.isTeacher ? '<span class="teacher-badge">أستاذ</span>' : ''}
                        <div style="color: #666; font-size: 0.9em;">النقاط: ${user.score}</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('leaderboardContainer').innerHTML = leaderboardHTML || '<p style="text-align: center; padding: 20px;">لا توجد بيانات حالياً</p>';
        }

        // تحميل المتجر
        function loadStore() {
            document.getElementById('storeScore').textContent = currentUser.score;
            
            const storeHTML = storeItems.map(item => {
                const isOwned = currentUser.ownedItems.includes(item.id);
                const canAfford = currentUser.score >= item.price;
                
                return `
                    <div class="store-item ${isOwned ? 'owned' : ''}">
                        <h4>${item.name}</h4>
                        <div style="font-size: 2em; margin: 10px 0;">
                            ${item.type === 'frame' ? '🖼️' : item.type === 'background' ? '🎨' : item.icon}
                        </div>
                        <p>السعر: ${item.price} نقطة</p>
                        ${isOwned ? 
                            '<button class="btn" style="background: #4CAF50;">مملوك</button>' :
                            `<button class="btn" onclick="buyItem(${item.id})" ${!canAfford ? 'disabled style="background: #ccc;"' : ''}>
                                ${canAfford ? 'شراء' : 'نقاط غير كافية'}
                            </button>`
                        }
                    </div>
                `;
            }).join('');
            
            document.getElementById('storeContainer').innerHTML = storeHTML;
        }

        // شراء عنصر
        function buyItem(itemId) {
            const item = storeItems.find(i => i.id === itemId);
            
            if (currentUser.score >= item.price) {
                currentUser.score -= item.price;
                currentUser.ownedItems.push(itemId);
                
                updateUserPoints();
                saveUserData();
                loadStore();
                
                alert(`تم شراء ${item.name} بنجاح! 🎉`);
            } else {
                alert('نقاطك غير كافية لشراء هذا العنصر');
            }
        }

        // تحميل الملف الشخصي
        function loadProfile() {
            const profileHTML = `
                <div style="background: white; padding: 20px; border-radius: 10px;">
                    <h3>معلوماتي الشخصية</h3>
                    <div style="margin: 20px 0;">
                        <label>الاسم الكامل:</label>
                        <input type="text" id="profileName" value="${currentUser.name}" style="width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    <div style="margin: 20px 0;">
                        <label>العمر:</label>
                        <input type="number" id="profileAge" value="${currentUser.age}" style="width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    <div style="margin: 20px 0;">
                        <label>كلمة المرور الجديدة:</label>
                        <input type="password" id="profilePassword" placeholder="اتركها فارغة إذا لم ترد تغييرها" style="width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    <div style="margin: 20px 0;">
                        <label>تغيير الصورة الشخصية:</label>
                        <input type="file" id="profileImageUpdate" accept="image/*" style="width: 100%; padding: 10px; margin: 5px 0;">
                    </div>
                    <button class="btn" onclick="updateProfile()">حفظ التغييرات</button>
                    
                    <hr style="margin: 30px 0;">
                    
                    <h3>إحصائياتي</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                        <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; text-align: center;">
                            <h4>النقاط الإجمالية</h4>
                            <div style="font-size: 2em; color: #667eea;">${currentUser.score}</div>
                        </div>
                        <div style="background: #f0f8f0; padding: 15px; border-radius: 8px; text-align: center;">
                            <h4>العناصر المملوكة</h4>
                            <div style="font-size: 2em; color: #4CAF50;">${currentUser.ownedItems.length}</div>
                        </div>
                    </div>
                    
                    <h4>العناصر المملوكة:</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0;">
                        ${currentUser.ownedItems.map(itemId => {
                            const item = storeItems.find(i => i.id === itemId);
                            return item ? `<span style="background: #e3f2fd; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">${item.name}</span>` : '';
                        }).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('profileContainer').innerHTML = profileHTML;
        }

        // تحديث الملف الشخصي
        function updateProfile() {
            const newName = document.getElementById('profileName').value.trim();
            const newAge = document.getElementById('profileAge').value;
            const newPassword = document.getElementById('profilePassword').value;
            const newImageFile = document.getElementById('profileImageUpdate').files[0];
            
            if (newName.split(' ').length < 2) {
                alert('يجب أن يكون الاسم مكوناً من كلمتين على الأقل');
                return;
            }
            
            currentUser.name = newName;
            currentUser.age = newAge;
            
            if (newPassword) {
                currentUser.password = newPassword;
                if (newPassword === '6450') {
                    currentUser.isTeacher = true;
                }
            }
            
            if (newImageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentUser.profileImage = e.target.result;
                    saveUserData();
                    showDashboard();
                    alert('تم تحديث الملف الشخصي بنجاح!');
                };
                reader.readAsDataURL(newImageFile);
            } else {
                saveUserData();
                showDashboard();
                alert('تم تحديث الملف الشخصي بنجاح!');
            }
        }

        // وظائف الأستاذ
        function clearAllChat() {
            if (confirm('هل أنت متأكد من حذف جميع رسائل الشات؟')) {
                localStorage.removeItem('chatMessages');
                if (document.getElementById('chatContainer')) {
                    loadChat();
                }
                alert('تم حذف جميع الرسائل');
            }
        }

        function resetAllScores() {
            if (confirm('هل أنت متأكد من إعادة تعيين نقاط جميع الطلاب؟')) {
                const users = getStoredData('users') || {};
                Object.keys(users).forEach(key => {
                    if (!users[key].isTeacher) {
                        users[key].score = 0;
                    }
                });
                localStorage.setItem('users', JSON.stringify(users));
                
                if (!currentUser.isTeacher) {
                    currentUser.score = 0;
                    updateUserPoints();
                }
                
                alert('تم إعادة تعيين النقاط لجميع الطلاب');
            }
        }

        function exportData() {
            const data = {
                users: getStoredData('users'),
                news: getStoredData('news'),
                homework: getStoredData('homework'),
                explanations: getStoredData('explanations'),
                chatMessages: getStoredData('chatMessages')
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'science_website_data.json';
            link.click();
            
            URL.revokeObjectURL(url);
        }

        // وظائف مساعدة
        function getStoredData(key) {
            try {
                return JSON.parse(localStorage.getItem(key));
            } catch {
                return null;
            }
        }

        function saveUserData() {
            const users = getStoredData('users') || {};
            users[currentUser.name] = currentUser;
            localStorage.setItem('users', JSON.stringify(users));
        }

        function loadUserData() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showDashboard();
                } catch {
                    // إذا كانت البيانات تالفة، ابدأ من جديد
                }
            }
        }

        function getUserScore(userName) {
            const users = getStoredData('users') || {};
            return users[userName] ? users[userName].score : 0;
        }

        function getUserOwnedItems(userName) {
            const users = getStoredData('users') || {};
            return users[userName] ? users[userName].ownedItems : [];
        }

        // إنشاء المزيد من الأسئلة
        function generateMoreQuestions() {
            const additionalQuestions = [
                {
                    question: "ما هي العلاقة بين المسافة والزمن في الحركة المنتظمة؟",
                    answers: ["علاقة عكسية", "علاقة طردية", "لا توجد علاقة", "علاقة تربيعية"],
                    correct: 1,
                    explanation: "في الحركة المنتظمة، المسافة تتناسب طردياً مع الزمن"
                },
                {
                    question: "أي من التالي يمثل تسارعاً موجباً؟",
                    answers: ["سيارة تتوقف", "كرة تسقط لأسفل", "قطار يسير بسرعة ثابتة", "دراجة تبطئ"],
                    correct: 1,
                    explanation: "الكرة التي تسقط لأسفل تزداد سرعتها بفعل الجاذبية، مما يعني تسارعاً موجباً"
                },
                {
                    question: "ما هو الفرق بين السرعة والسرعة المتجهة؟",
                    answers: ["لا يوجد فرق", "السرعة المتجهة تشمل الاتجاه", "السرعة أكبر دائماً", "السرعة المتجهة أصغر دائماً"],
                    correct: 1,
                    explanation: "السرعة المتجهة تشمل كلاً من المقدار والاتجاه، بينما السرعة مقدار فقط"
                },
                {
                    question: "إذا كانت سرعة جسم 30 م/ث، فكم تساوي بالكيلومتر/ساعة؟",
                    answers: ["108 كم/ساعة", "30 كم/ساعة", "8.33 كم/ساعة", "300 كم/ساعة"],
                    correct: 0,
                    explanation: "للتحويل من م/ث إلى كم/ساعة نضرب في 3.6: 30 × 3.6 = 108 كم/ساعة"
                },
                {
                    question: "ما هي وحدة قياس التسارع في النظام الدولي؟",
                    answers: ["م/ث", "م/ث²", "كم/ساعة", "م²/ث"],
                    correct: 1,
                    explanation: "وحدة قياس التسارع في النظام الدولي هي متر/ثانية² (م/ث²)"
                }
            ];
            
            questions.push(...additionalQuestions);
            
            // إضافة المزيد من الأسئلة لتصل إلى 100 سؤال
            while (questions.length < 100) {
                const randomQuestion = {
                    question: `سؤال رقم ${questions.length + 1}: إذا تحرك جسم بسرعة ${Math.floor(Math.random() * 50) + 10} م/ث لمدة ${Math.floor(Math.random() * 10) + 1} ثانية، فما المسافة المقطوعة؟`,
                    answers: [],
                    correct: 0,
                    explanation: "المسافة = السرعة × الزمن"
                };
                
                const speed = Math.floor(Math.random() * 50) + 10;
                const time = Math.floor(Math.random() * 10) + 1;
                const correctDistance = speed * time;
                
                randomQuestion.answers = [
                    `${correctDistance} متر`,
                    `${correctDistance + Math.floor(Math.random() * 20) + 5} متر`,
                    `${correctDistance - Math.floor(Math.random() * 20) + 5} متر`,
                    `${Math.floor(correctDistance / 2)} متر`
                ];
                
                questions.push(randomQuestion);
            }
        }

        // حفظ البيانات عند إغلاق الصفحة
        window.addEventListener('beforeunload', function() {
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
        });
    </script>
</body>
</html>
